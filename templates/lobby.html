{% extends "base.html" %}
{% block body %}
<div class="card">
  <h2 class="title">ê²Œì„ ë¡œë¹„</h2>
  <p class="stitle">ì ‘ì†ì ëª©ë¡</p>
  <ul id="players" class="list"></ul>
  <hr>
  <div class="grid grid-2">
    <div>
      <div class="pill">ë¼ìš´ë“œ: <span id="round">-</span> / 5</div>
    </div>
    <div class="center">
      <button id="startBtn" class="btn btn-primary" disabled>ê²Œì„ ì‹œì‘</button>
    </div>
  </div>
</div>

<script>
const socket = io();
const playersEl = document.getElementById('players');
const startBtn = document.getElementById('startBtn');

socket.on('connect', () => {
  socket.emit('join', {
    name: "{{ session.get('name','') }}",
    // ğŸ” ìˆ˜ì •: is_host ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ ì„¸ì…˜ì— ì €ì¥ëœ í˜¸ìŠ¤íŠ¸ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì „ë‹¬
    host_code: "{{ session.get('host_code','') }}"
  });
});

socket.on('join_ok', (d) => {
  if (d.is_host) startBtn.disabled = false;
});

socket.on('state', (s) => {
  playersEl.innerHTML = '';
  s.players.forEach(p=>{
    const li = document.createElement('li');
    li.className = 'li';
    li.textContent = p.name + (p.is_host ? ' ğŸ‘‘' : '');
    playersEl.appendChild(li);
  });
  document.getElementById('round').textContent = s.round;
});

startBtn?.addEventListener('click', ()=>{
  socket.emit('start_game');
});

socket.on('move_game', ()=>{
  location.href = "{{ url_for('game') }}";
});

socket.on('error_msg', (e)=>alert(e.msg || 'ì—ëŸ¬ê°€ ë°œìƒí–ˆì–´ìš”.'));
</script>
{% endblock %}
